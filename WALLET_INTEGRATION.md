# WALLET INTEGRATION GUIDE

## SUPPORTED WALLETS

XAH PAYROLL SUPPORTS MULTIPLE XRPL WALLET PROVIDERS FOR MAXIMUM FLEXIBILITY AND USER CHOICE:

### 1. XAMAN (XUMM) - MOBILE WALLET
**RECOMMENDED FOR**: MOBILE USERS, QR CODE AUTHENTICATION

- **TYPE**: MOBILE APP (IOS/ANDROID)
- **CONNECTION METHOD**: QR CODE SCANNING
- **DOWNLOAD**: https://xaman.app
- **FEATURES**:
  - MOST SECURE OPTION (PRIVATE KEYS NEVER LEAVE DEVICE)
  - WORKS ON ANY DEVICE WITH CAMERA
  - NO BROWSER EXTENSION REQUIRED
  - BEST FOR MOBILE-FIRST WORKFLOWS

**HOW TO CONNECT:**
1. INSTALL XAMAN APP ON YOUR MOBILE DEVICE
2. CREATE OR IMPORT YOUR WALLET
3. CLICK "CONNECT WALLET" ON XAH PAYROLL
4. SELECT "XAMAN (XUMM)"
5. SCAN THE QR CODE WITH YOUR XAMAN APP
6. APPROVE THE SIGN-IN REQUEST

---

### 2. CROSSMARK - BROWSER EXTENSION
**RECOMMENDED FOR**: DESKTOP USERS, QUICK ACCESS

- **TYPE**: BROWSER EXTENSION (CHROME, FIREFOX, EDGE, BRAVE)
- **CONNECTION METHOD**: BROWSER EXTENSION POPUP
- **DOWNLOAD**: https://crossmark.io
- **FEATURES**:
  - FAST ONE-CLICK CONNECTION
  - INTEGRATED DIRECTLY IN BROWSER
  - SUPPORTS MULTIPLE ACCOUNTS
  - GREAT FOR DESKTOP WORKFLOWS

**HOW TO CONNECT:**
1. INSTALL CROSSMARK EXTENSION FROM CHROME WEB STORE
2. SET UP YOUR WALLET IN THE EXTENSION
3. CLICK "CONNECT WALLET" ON XAH PAYROLL
4. SELECT "CROSSMARK"
5. APPROVE THE CONNECTION IN THE POPUP

---

### 3. GEMWALLET - BROWSER EXTENSION
**RECOMMENDED FOR**: ALTERNATIVE BROWSER WALLET OPTION

- **TYPE**: BROWSER EXTENSION (CHROME, FIREFOX, EDGE)
- **CONNECTION METHOD**: BROWSER EXTENSION POPUP
- **DOWNLOAD**: https://gemwallet.app
- **FEATURES**:
  - MODERN UI/UX
  - MULTI-NETWORK SUPPORT
  - TRANSACTION SIGNING
  - ALTERNATIVE TO CROSSMARK

**HOW TO CONNECT:**
1. INSTALL GEMWALLET EXTENSION FROM CHROME WEB STORE
2. CREATE OR IMPORT YOUR WALLET
3. CLICK "CONNECT WALLET" ON XAH PAYROLL
4. SELECT "GEMWALLET"
5. APPROVE THE CONNECTION REQUEST

---

## TECHNICAL IMPLEMENTATION

### FRONTEND INTEGRATION

THE FRONTEND USES A UNIFIED `WALLETCONTEXT` THAT ABSTRACTS WALLET-SPECIFIC IMPLEMENTATIONS:

```typescript
// Wallet providers supported
type WalletProvider = 'xaman' | 'crossmark' | 'gemwallet' | 'manual'

// Connection flow
const { connectWallet, disconnectWallet, walletAddress, balance } = useWallet()

// Connect to any wallet
await connectWallet('xaman')  // QR code flow
await connectWallet('crossmark')  // Extension popup
await connectWallet('gemwallet')  // Extension popup
```

### WALLET DETECTION

THE APP AUTOMATICALLY DETECTS WHICH WALLETS ARE AVAILABLE:

- **XAMAN**: ALWAYS AVAILABLE (USES QR CODE, NO INSTALLATION CHECK NEEDED)
- **CROSSMARK**: DETECTED VIA `WINDOW.CROSSMARK` OBJECT
- **GEMWALLET**: DETECTED VIA `@GEMWALLET/API` PACKAGE

### DEPENDENCIES

```json
{
  "xrpl": "^2.x.x",           // Core XRPL library
  "@gemwallet/api": "^3.x.x"  // GemWallet integration
}
```

---

## USER PROFILE & AUTHENTICATION

### WALLET-BASED AUTHENTICATION

- **NO PASSWORDS REQUIRED** - AUTHENTICATION IS DONE VIA WALLET SIGNATURES
- **WALLET ADDRESS = USER ID** - EACH WALLET ADDRESS IS UNIQUE
- **PROFILE PERSISTENCE** - USER PROFILES ARE STORED IN POSTGRESQL DATABASE

### ACCOUNT TYPE RESTRICTIONS

⚠️ **IMPORTANT**: A WALLET ADDRESS CAN ONLY BE REGISTERED AS ONE ACCOUNT TYPE:

- **EMPLOYEE ACCOUNT**: FOR WORKERS WHO LOG HOURS AND RECEIVE PAYMENTS
- **NGO/EMPLOYER ACCOUNT**: FOR ORGANIZATIONS THAT MANAGE WORKERS AND FUND ESCROW

**WHY THIS RESTRICTION?**
- PREVENTS CONFLICTS IN PAYMENT FLOWS
- ENSURES CLEAR ROLE SEPARATION
- MAINTAINS AUDIT TRAIL INTEGRITY

**SOLUTION**: USE DIFFERENT WALLET ADDRESSES FOR DIFFERENT ROLES.

---

## PROFILE SETUP FLOW

### FIRST-TIME USERS

1. **CONNECT WALLET** → CHOOSE YOUR WALLET PROVIDER
2. **WALLET CONNECTION** → APPROVE IN WALLET APP/EXTENSION
3. **PROFILE CHECK** → SYSTEM CHECKS IF PROFILE EXISTS
4. **PROFILE SETUP** → IF NEW USER, COMPLETE PROFILE FORM:
   - DISPLAY NAME
   - ORGANIZATION NAME (FOR NGO/EMPLOYER ONLY)
   - EMAIL (OPTIONAL)
   - PHONE NUMBER (OPTIONAL)
   - ACCOUNT TYPE (EMPLOYEE OR NGO/EMPLOYER)
5. **TERMS OF SERVICE** → ACCEPT TERMS
6. **DASHBOARD ACCESS** → REDIRECTED TO APPROPRIATE DASHBOARD

### RETURNING USERS

1. **CONNECT WALLET** → CHOOSE YOUR WALLET PROVIDER
2. **WALLET CONNECTION** → APPROVE IN WALLET APP/EXTENSION
3. **AUTO-LOGIN** → SYSTEM RETRIEVES EXISTING PROFILE
4. **DASHBOARD ACCESS** → AUTOMATICALLY REDIRECTED TO DASHBOARD

---

## SECURITY CONSIDERATIONS

### PRIVATE KEY MANAGEMENT

- **NON-CUSTODIAL**: XAH PAYROLL NEVER HAS ACCESS TO PRIVATE KEYS
- **WALLET-CONTROLLED**: ALL TRANSACTIONS REQUIRE WALLET APPROVAL
- **NO KEY STORAGE**: PRIVATE KEYS REMAIN IN WALLET APP/EXTENSION

### TRANSACTION SIGNING

ALL TRANSACTIONS ARE SIGNED BY THE USER'S WALLET:
1. APP PREPARES TRANSACTION
2. SENDS TO WALLET FOR SIGNING
3. USER REVIEWS AND APPROVES IN WALLET
4. SIGNED TRANSACTION SUBMITTED TO XRPL

### SESSION MANAGEMENT

- **WALLET-BASED SESSIONS**: NO TRADITIONAL PASSWORDS
- **AUTO-LOGOUT**: SESSIONS EXPIRE ON WALLET DISCONNECTION
- **RE-AUTHENTICATION**: REQUIRES WALLET SIGNATURE FOR SENSITIVE OPERATIONS

---

## TROUBLESHOOTING

### WALLET NOT DETECTED

**CROSSMARK/GEMWALLET NOT SHOWING:**
- ENSURE EXTENSION IS INSTALLED
- REFRESH THE PAGE AFTER INSTALLATION
- CHECK IF EXTENSION IS ENABLED IN BROWSER
- TRY A DIFFERENT BROWSER

**XAMAN QR CODE NOT WORKING:**
- ENSURE XAMAN APP IS INSTALLED ON MOBILE DEVICE
- CHECK CAMERA PERMISSIONS
- TRY GENERATING A NEW QR CODE
- ENSURE MOBILE DEVICE HAS INTERNET CONNECTION

### CONNECTION ERRORS

**"ACCOUNT NOT FOUND" ERROR:**
- THIS IS NORMAL FOR NEW TESTNET ACCOUNTS
- ACCOUNT WILL BE CREATED AFTER FIRST TRANSACTION
- BALANCE WILL SHOW AS 0 UNTIL FUNDED

**"CONNECTION REJECTED":**
- USER DECLINED CONNECTION IN WALLET
- TRY CONNECTING AGAIN AND APPROVE THE REQUEST

**"WALLET EXTENSION NOT FOUND":**
- EXTENSION NOT INSTALLED OR DISABLED
- INSTALL FROM OFFICIAL SOURCE AND REFRESH PAGE

### PROFILE ISSUES

**"WALLET ALREADY REGISTERED AS [TYPE]":**
- THIS WALLET IS ALREADY USED FOR A DIFFERENT ACCOUNT TYPE
- USE A DIFFERENT WALLET ADDRESS
- CANNOT SWITCH BETWEEN EMPLOYEE AND NGO/EMPLOYER TYPES

---

## BEST PRACTICES

### FOR USERS

1. **USE TESTNET FIRST**: TEST WITH TESTNET XAH BEFORE USING REAL FUNDS
2. **BACKUP WALLET**: ALWAYS BACKUP YOUR WALLET SEED/RECOVERY PHRASE
3. **VERIFY TRANSACTIONS**: ALWAYS REVIEW TRANSACTION DETAILS BEFORE APPROVING
4. **SEPARATE WALLETS**: USE DIFFERENT WALLETS FOR EMPLOYEE VS NGO/EMPLOYER ROLES
5. **KEEP EXTENSIONS UPDATED**: REGULARLY UPDATE WALLET EXTENSIONS

### FOR DEVELOPERS

1. **ERROR HANDLING**: ALWAYS HANDLE WALLET CONNECTION ERRORS GRACEFULLY
2. **USER FEEDBACK**: SHOW CLEAR LOADING STATES DURING WALLET OPERATIONS
3. **NETWORK DETECTION**: DETECT AND DISPLAY CURRENT NETWORK (TESTNET/MAINNET)
4. **TRANSACTION VALIDATION**: VALIDATE TRANSACTIONS BEFORE SENDING TO WALLET
5. **LOGOUT CLEANUP**: PROPERLY DISCONNECT WALLET ON LOGOUT

---

### FEEDBACK

HAVE SUGGESTIONS FOR WALLET INTEGRATIONS? OPEN AN ISSUE ON GITHUB!

---

## RESOURCES

- **XAMAN DOCUMENTATION**: https://xumm.readme.io/
- **CROSSMARK DOCUMENTATION**: https://crossmark.io/docs
- **GEMWALLET DOCUMENTATION**: https://gemwallet.app/docs
- **XRPL DOCUMENTATION**: https://xrpl.org/docs
---

**LAST UPDATED**: NOVEMBER 2025
**VERSION**: 1.0.0

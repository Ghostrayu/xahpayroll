# XAH PAYROLL - WEB APP

## OVERVIEW

XAH PAYROLL IS A DECENTRALIZED PAYROLL MANAGEMENT SYSTEM THAT ENABLES HOURLY WAGE PAYMENTS THROUGH XAH MICROTRANSACTIONS. THE SYSTEM USES PAYMENT CHANNEL HOOKS TO VERIFY NGO INPUTS, MANAGES ESCROWED XAH FUNDS, AND AUTOMATICALLY DISTRIBUTES HOURLY PAYMENTS WITH BUILT-IN TIMEOUT MECHANISMS.

## CORE FEATURES

### CORE FUNCTIONALITY
- **HOURLY AUTOMATIC PAYMENTS**: WORKERS RECEIVE XAH DIRECTLY TO THEIR WALLETS EVERY HOUR
- **REAL-TIME TRACKING**: LIVE MONITORING OF WORK HOURS AND PAYMENT STATUS
- **WORKER MANAGEMENT**: ADD WORKERS WITH XAMAN QR CODE SCANNING FOR EASY ONBOARDING
- **ESCROW MANAGEMENT**: SECURE FUND HOLDING WITH TRANSPARENT BALANCE TRACKING
- **XRPL HOOKS INTEGRATION**: AUTOMATED PAYMENT VERIFICATION AND PROCESSING
- **MULTI-ROLE SUPPORT**: SEPARATE INTERFACES FOR WORKERS, NGOS, AND EMPLOYERS
- **MULTI-WALLET SUPPORT**: CONNECT WITH XAMAN (XUMM), CROSSMARK, OR GEMWALLET

### üïê PATH D TWO-FIELD BALANCE ARCHITECTURE
- **OFF-CHAIN BALANCE ACCUMULATION**: WORKER EARNINGS ACCUMULATE IN DATABASE (`off_chain_accumulated_balance`) AFTER EACH WORK SESSION FOR OPTIMAL PERFORMANCE
- **ON-CHAIN PAYMENT CHANNEL ESCROW**: XAH FUNDS LOCKED ON XAHAU LEDGER IN PAYMENT CHANNELS WITH TRANSPARENT `on_chain_balance` QUERIES
- **EFFICIENT FINAL SETTLEMENT**: ACCUMULATED BALANCE PAID VIA SINGLE PAYMENTCHANNELCLAIM TRANSACTION WHEN CHANNEL CLOSES, MINIMIZING LEDGER FEES

### üîê PAYMENT CHANNEL HOOKS
- **NGO INPUT VERIFICATION**: CRYPTOGRAPHIC VERIFICATION OF EMPLOYER/NGO INPUTS BEFORE PAYMENT PROCESSING
- **HOOK-BASED VALIDATION**: SMART CONTRACT HOOKS VALIDATE WORK LOGS AND PAYMENT CONDITIONS
- **TAMPER-PROOF RECORDS**: IMMUTABLE ON-CHAIN VERIFICATION OF ALL TRANSACTIONS

### üí∞ ESCROW & BALANCE MANAGEMENT
- **ON-CHAIN ESCROW**: EMPLOYER FUNDS LOCKED IN XAHAU PAYMENT CHANNELS WITH CRYPTOGRAPHIC SECURITY
- **TWO-FIELD BALANCE SYSTEM**: SEPARATION OF `off_chain_accumulated_balance` (WORKER EARNINGS) AND `on_chain_balance` (LEDGER STATE)
- **REAL-TIME TRACKING**: DASHBOARD DISPLAYS BOTH ACCUMULATED EARNINGS AND REMAINING ESCROW WITH NETWORK-AWARE LEDGER VERIFICATION

### ‚è±Ô∏è AUTOMATED TIMEOUT SYSTEM
- **INACTIVITY DETECTION**: AUTOMATIC TIMEOUT WHEN WORKERS STOP LOGGING HOURS
- **GRACE PERIODS**: CONFIGURABLE TIMEOUT THRESHOLDS BEFORE PAYMENT SUSPENSION
- **SESSION MANAGEMENT**: CLEAN SESSION TERMINATION AND ESCROW FUND RETURN ON TIMEOUT

## TECHNICAL ARCHITECTURE

### PAYMENT FLOW (PATH D TWO-FIELD ARCHITECTURE)
```
1. NGO/EMPLOYER CREATES PAYMENT CHANNEL
   - PAYMENTCHANNELCREATE TRANSACTION ON XAHAU LEDGER
   - XAH ESCROW LOCKED ON-CHAIN WITH CONFIGURABLE SETTLEDELAY (1-72 HOURS)
   - CHANNEL ID RETRIEVED VIA 3-TIER FALLBACK SYSTEM (TX QUERY ‚Üí ACCOUNT_CHANNELS ‚Üí RETRY)

2. WORKER LOGS HOURS VIA DASHBOARD
   - CLOCK IN/OUT TRACKED IN WORK_SESSIONS TABLE (OFF-CHAIN)
   - REAL-TIME SESSION MONITORING WITHOUT LEDGER WRITES

3. OFF-CHAIN BALANCE ACCUMULATION
   - ON CLOCK-OUT: off_chain_accumulated_balance += (HOURS_WORKED √ó HOURLY_RATE)
   - DATABASE UPDATE ONLY - NO XRPL TRANSACTIONS DURING WORK
   - OPTIMAL PERFORMANCE: NO LEDGER FEES FOR HOURLY TRACKING

4. CHANNEL CLOSURE REQUEST (NGO OR WORKER)
   - NGO REQUESTS: "CANCEL CHANNEL" BUTTON ON DASHBOARD
   - WORKER REQUESTS: "CLOSE CHANNEL" BUTTON ON WORKER DASHBOARD
   - STATUS ‚Üí 'CLOSING' WITH SETTLEDELAY PROTECTION

5. ON-CHAIN PAYMENT VIA PAYMENTCHANNELCLAIM
   - BALANCE FIELD: off_chain_accumulated_balance CONVERTED TO DROPS
   - WORKER RECEIVES ACCUMULATED EARNINGS IMMEDIATELY
   - UNUSED ESCROW RETURNS TO NGO AUTOMATICALLY (NO AMOUNT FIELD)
   - TFCLOSE FLAG: PERMANENT CHANNEL REMOVAL FROM LEDGER

6. TRANSACTION VERIFICATION & DATABASE SYNC
   - POLLING LOOP: WAIT FOR TX VALIDATION ON XAHAU LEDGER (MAX 30 SECONDS)
   - VERIFY: validated=TRUE, result=tesSUCCESS
   - VERIFY: CHANNEL REMOVED FROM LEDGER (ACCOUNT_CHANNELS QUERY ‚Üí entryNotFound)
   - DATABASE: off_chain_accumulated_balance ‚Üí 0, STATUS ‚Üí 'CLOSED', last_ledger_sync ‚Üí NOW()

7. NETWORK-AWARE EXPLORER LINKS
   - TESTNET: https://explorer.xahau-test.net/tx/{HASH}
   - MAINNET: https://explorer.xahau.network/tx/{HASH}
   - AUTO-DETECTED VIA VITE_XRPL_NETWORK ENVIRONMENT VARIABLE
```

### TECHNOLOGY STACK
- **BLOCKCHAIN**: XAH LEDGER (XRPL)
- **SMART CONTRACTS**: PAYMENT CHANNEL HOOKS
- **FRONTEND**: REACT.JS WITH WEB3 INTEGRATION
- **BACKEND**: NODE.JS WITH XRPL SDK
- **DATABASE**: POSTGRESQL FOR OFF-CHAIN RECORDS
- **AUTHENTICATION**: WALLET-BASED AUTHENTICATION

## KEY COMPONENTS

### 1. WORKER INTERFACE
- CLOCK IN/OUT FUNCTIONALITY
- REAL-TIME HOURS TRACKER
- PAYMENT HISTORY DASHBOARD
- WALLET CONNECTION AND BALANCE DISPLAY
- **PAYMENT CHANNELS MANAGEMENT**: VIEW AND CLOSE ACTIVE PAYMENT CHANNELS
  - SEE ALL PAYMENT CHANNELS ACROSS MULTIPLE EMPLOYERS
  - TRACK ACCUMULATED BALANCE AND ESCROW STATUS
  - WORKER-INITIATED CHANNEL CLOSURE WITH BALANCE PROTECTION

### 2. EMPLOYER/NGO DASHBOARD
- **WORKER MANAGEMENT**: ADD WORKERS WITH XAMAN QR CODE SCANNING OR MANUAL ENTRY
- **WORKER DROPDOWN**: SELECT WORKERS FROM DROPDOWN WHEN CREATING PAYMENT CHANNELS
- **ESCROW FUNDING INTERFACE**: FUND PAYMENT CHANNELS WITH XAH
- **PAYMENT ANALYTICS AND REPORTS**: MONITOR ACTIVE CHANNELS AND WORKER STATUS
- **HOOK CONFIGURATION PANEL**: CONFIGURE PAYMENT CHANNEL SETTINGS

### 3. PAYMENT CHANNEL SYSTEM
- MULTI-SIGNATURE PAYMENT CHANNELS
- HOOK-BASED VALIDATION LOGIC
- AUTOMATIC SETTLEMENT ON TIMEOUT
- CHANNEL STATE MANAGEMENT

### 4. VERIFICATION HOOKS
- **INPUT VALIDATION HOOK**: VERIFIES NGO AUTHORIZATION SIGNATURES
- **TIME VERIFICATION HOOK**: VALIDATES WORK HOUR SUBMISSIONS
- **PAYMENT AUTHORIZATION HOOK**: CONFIRMS ESCROW AVAILABILITY BEFORE RELEASE
- **TIMEOUT HOOK**: TRIGGERS AUTOMATIC SESSION TERMINATION

## SECURITY FEATURES

- **MULTI-SIGNATURE ESCROW**: REQUIRES BOTH EMPLOYER AND SYSTEM SIGNATURES FOR FUND MANAGEMENT
- **RATE LIMITING**: PREVENTS SPAM AND FRAUDULENT HOUR LOGGING
- **AUDIT TRAIL**: COMPLETE TRANSACTION HISTORY ON-CHAIN
- **ENCRYPTED COMMUNICATIONS**: ALL API CALLS SECURED WITH TLS
- **WALLET SECURITY**: NON-CUSTODIAL DESIGN - USERS MAINTAIN CONTROL OF PRIVATE KEYS

## SETUP & INSTALLATION

### PREREQUISITES
```bash
- NODE.JS V18+
- POSTGRESQL 14+
- XRPL TESTNET/MAINNET ACCESS
- WEB3 WALLET (E.G., XUMM, CROSSMARK)
```

### INSTALLATION
```bash
# CLONE REPOSITORY
GIT CLONE HTTPS://GITHUB.COM/YOUR-ORG/XAH-PAYROLL.GIT
CD XAH-PAYROLL

# INSTALL ALL DEPENDENCIES (ROOT, FRONTEND, AND BACKEND)
NPM RUN INSTALL:ALL

# CONFIGURE ENVIRONMENT VARIABLES
# FRONTEND
CP FRONTEND/.ENV.EXAMPLE FRONTEND/.ENV
# EDIT FRONTEND/.ENV WITH BACKEND URL AND NETWORK CONFIGURATION

# BACKEND
CP BACKEND/.ENV.EXAMPLE BACKEND/.ENV
# EDIT BACKEND/.ENV WITH YOUR XAMAN API CREDENTIALS AND DATABASE SETTINGS

# START BOTH SERVERS (BACKEND + FRONTEND)
NPM RUN DEV
```

### NETWORK CONFIGURATION

**SWITCH BETWEEN TESTNET AND MAINNET:**

EDIT `FRONTEND/.ENV` AND CHANGE THE NETWORK VARIABLE:

```ENV
# FOR MAINNET (PRODUCTION)
VITE_XRPL_NETWORK=MAINNET

# FOR TESTNET (DEVELOPMENT/TESTING)
VITE_XRPL_NETWORK=TESTNET
```

**IMPORTANT:** RESTART THE DEV SERVER AFTER CHANGING THE NETWORK.

SEE [NETWORK_CONFIG.MD](./NETWORK_CONFIG.MD) FOR DETAILED NETWORK SWITCHING INSTRUCTIONS.

### DEVELOPMENT COMMANDS

```bash
# START BOTH BACKEND AND FRONTEND SERVERS
NPM RUN DEV

# START BACKEND ONLY
NPM RUN DEV:BACKEND

# START FRONTEND ONLY
NPM RUN DEV:FRONTEND

# INSTALL ALL DEPENDENCIES
NPM RUN INSTALL:ALL

# BUILD FRONTEND FOR PRODUCTION
NPM RUN BUILD

# RUN LINTER
NPM RUN LINT
```

### SERVER URLS
- **FRONTEND**: HTTP://LOCALHOST:3000 (OPENS AUTOMATICALLY)
- **BACKEND API**: HTTP://LOCALHOST:3001
- **HEALTH CHECK**: HTTP://LOCALHOST:3001/HEALTH

### ENVIRONMENT VARIABLES
```env
XRPL_NETWORK=TESTNET
XRPL_WEBHOOK_URL=YOUR_WEBHOOK_URL
DATABASE_URL=POSTGRESQL://USER:PASSWORD@LOCALHOST:5432/XAHPAYROLL
ESCROW_WALLET_SEED=YOUR_ESCROW_WALLET_SEED
PAYMENT_INTERVAL_MINUTES=60
TIMEOUT_THRESHOLD_MINUTES=15
```

## USAGE

### ‚ö†Ô∏è IMPORTANT: WALLET ADDRESS RESTRICTIONS
**A WALLET ADDRESS CAN ONLY BE REGISTERED AS EITHER AN EMPLOYEE OR AN NGO/EMPLOYER, NOT BOTH.**
- IF YOUR WALLET IS REGISTERED AS AN EMPLOYEE, YOU CANNOT USE IT FOR AN NGO/EMPLOYER ACCOUNT
- IF YOUR WALLET IS REGISTERED AS AN NGO/EMPLOYER, YOU CANNOT USE IT FOR AN EMPLOYEE ACCOUNT
- USE SEPARATE WALLET ADDRESSES FOR DIFFERENT ACCOUNT TYPES

### FOR WORKERS
1. CONNECT YOUR XAH WALLET TO THE PLATFORM
2. COMPLETE YOUR PROFILE (DISPLAY NAME, EMAIL, ETC.)
3. ACCEPT THE TERMS OF SERVICE
4. CLICK "START SHIFT" TO BEGIN LOGGING HOURS
5. WORK IS AUTOMATICALLY TRACKED AND VERIFIED VIA HOOKS
6. RECEIVE XAH PAYMENTS EVERY HOUR TO YOUR WALLET
7. CLICK "END SHIFT" WHEN DONE, OR AUTOMATIC TIMEOUT AFTER INACTIVITY

### FOR EMPLOYERS/NGOS
1. CONNECT YOUR XRPL WALLET TO THE PLATFORM (MUST BE DIFFERENT FROM ANY EMPLOYEE WALLET)
2. COMPLETE YOUR ORGANIZATION PROFILE
3. ACCEPT THE TERMS OF SERVICE
4. **ADD WORKERS TO YOUR ORGANIZATION**:
   - CLICK "ADD WORKER" BUTTON ON DASHBOARD
   - OPTION 1: USE "SCAN WITH XAMAN" TO SCAN WORKER'S QR CODE (RECOMMENDED)
   - OPTION 2: MANUALLY ENTER WORKER NAME AND WALLET ADDRESS
   - WORKERS MUST BE ADDED BEFORE CREATING PAYMENT CHANNELS
5. **CREATE PAYMENT CHANNEL**:
   - SELECT WORKER FROM DROPDOWN (SHOWS ALL ADDED WORKERS)
   - CONFIGURE JOB NAME, HOURLY RATE, AND DURATION
   - FUND ESCROW WITH XAH
   - WORKER'S WALLET ADDRESS DISPLAYED BELOW DROPDOWN FOR VERIFICATION
6. USE NGO DASHBOARD TO MONITOR REAL-TIME PAYMENT ACTIVITY, ESCROW BALANCE, REVIEW PAYMENT REPORTS, AND ANALYTICS.

## WORKER MANAGEMENT WORKFLOW

### ADDING WORKERS TO YOUR ORGANIZATION

**STEP 1: ADD WORKER**
- CLICK "ADD WORKER" BUTTON ON NGO DASHBOARD
- CHOOSE ONE OF TWO OPTIONS:
  1. **SCAN WITH XAMAN** (RECOMMENDED):
     - CLICK "SCAN WITH XAMAN" BUTTON
     - QR CODE APPEARS ON SCREEN
     - WORKER SCANS QR CODE WITH XAMAN WALLET
     - WALLET ADDRESS AUTO-FILLS WHEN WORKER APPROVES
  2. **MANUAL ENTRY**:
     - ENTER WORKER NAME
     - ENTER WORKER'S XRPL WALLET ADDRESS (STARTS WITH 'R')
- CLICK "ADD WORKER"
- WORKER IS NOW ADDED TO YOUR ORGANIZATION

**STEP 2: CREATE PAYMENT CHANNEL**
- CLICK "CREATE PAYMENT CHANNEL" BUTTON
- SELECT WORKER FROM DROPDOWN (SHOWS ALL ADDED WORKERS)
- WORKER'S WALLET ADDRESS DISPLAYS BELOW DROPDOWN FOR VERIFICATION
- CONFIGURE JOB DETAILS (NAME, HOURLY RATE, DURATION)
- FUND WITH XAH
- SIGN TRANSACTION WITH YOUR WALLET

**KEY FEATURES:**
- ‚úÖ SAME WORKER CAN WORK FOR MULTIPLE ORGANIZATIONS
- ‚úÖ SAME WORKER CAN HAVE MULTIPLE PAYMENT CHANNELS (DIFFERENT JOBS)
- ‚úÖ WORKER ADDRESSES VALIDATED AUTOMATICALLY
- ‚úÖ PREVENTS NGO/EMPLOYER WALLETS FROM BEING ADDED AS WORKERS
- ‚úÖ QR CODE SCANNING ELIMINATES ADDRESS ENTRY ERRORS

## PAYMENT CHANNEL CONFIGURATION

### CREATING A PAYMENT CHANNEL
```javascript
CONST PAYMENTCHANNEL = AWAIT XRPL.CREATEPAYMENTCHANNEL({
  ACCOUNT: EMPLOYERWALLET,
  DESTINATION: WORKERWALLET,
  AMOUNT: ESCROWAMOUNT,
  SETTLEDELAY: 3600, // 1 HOUR IN SECONDS
  PUBLICKEY: HOOKPUBLICKEY
});
```

### HOOK VERIFICATION LOGIC
```javascript
// PSEUDO-CODE FOR NGO INPUT VERIFICATION HOOK
FUNCTION VERIFYNGOINPUT(TRANSACTION) {
  CONST NGOSIGNATURE = TRANSACTION.MEMOS.NGOSIGNATURE;
  CONST ISVALID = CRYPTOVERIFY(NGOSIGNATURE, NGOPUBLICKEY);

  IF (!ISVALID) {
    RETURN HOOK_REJECT;
  }

  RETURN HOOK_ACCEPT;
}
```

### CANCELING A PAYMENT CHANNEL

NGOS/EMPLOYERS CAN CANCEL ACTIVE PAYMENT CHANNELS TO STOP PAYMENTS AND RECOVER UNUSED ESCROW FUNDS.

**HOW TO CANCEL A PAYMENT CHANNEL:**

1. **GO TO NGO DASHBOARD**
   - NAVIGATE TO "ACTIVE PAYMENT CHANNELS" SECTION
   - LOCATE THE CHANNEL YOU WANT TO CANCEL

2. **CLICK "CANCEL CHANNEL" BUTTON**
   - RED BUTTON APPEARS ON EACH ACTIVE PAYMENT CHANNEL CARD
   - BUTTON SHOWS "CANCELING..." DURING PROCESSING

3. **REVIEW CANCELLATION DETAILS**
   - CONFIRMATION MODAL DISPLAYS:
     - JOB NAME AND WORKER DETAILS
     - CURRENT ESCROW BALANCE
     - ACCUMULATED WORKER BALANCE
     - HOURS WORKED
   - IMPORTANT INFORMATION:
     - UNUSED ESCROW WILL BE RETURNED TO YOUR WALLET
     - WORKER RECEIVES ACCUMULATED BALANCE
     - ACTION CANNOT BE UNDONE

4. **CONFIRM CANCELLATION**
   - CLICK "CANCEL CHANNEL" TO PROCEED
   - CLICK "KEEP CHANNEL" TO ABORT

5. **SIGN TRANSACTION**
   - YOUR WALLET (XAMAN/CROSSMARK/GEMWALLET) WILL PROMPT FOR SIGNATURE
   - SIGN THE `PAYMENTCHANNELCLAIM` TRANSACTION
   - WAIT FOR CONFIRMATION (~5 SECONDS)

6. **COMPLETION**
   - SUCCESS MESSAGE DISPLAYS ESCROW RETURN AMOUNT
   - WORKER PAYMENT AND TRANSACTION HASH SHOWN
   - CHANNEL REMOVED FROM ACTIVE LIST
   - DASHBOARD AUTOMATICALLY REFRESHES

**IMPORTANT NOTES:**
- ‚úÖ ONLY THE CHANNEL OWNER (NGO/EMPLOYER) CAN CANCEL
- ‚úÖ WORKER RECEIVES ALL ACCUMULATED UNPAID BALANCE
- ‚úÖ UNUSED ESCROW AUTOMATICALLY RETURNS TO YOUR WALLET
- ‚úÖ CANCELLATION IS PERMANENT AND CANNOT BE UNDONE
- ‚úÖ WORKS WITH ALL WALLET PROVIDERS (XAMAN, CROSSMARK, GEMWALLET)
- ‚ö†Ô∏è CANNOT CANCEL ALREADY-CLOSED CHANNELS

**EXAMPLE CANCELLATION FLOW:**
```
ESCROW FUNDED: 1000 XAH
WORKER ACCUMULATED: 150 XAH (15 HOURS @ 10 XAH/HR)
UNUSED ESCROW: 850 XAH

AFTER CANCELLATION:
- WORKER RECEIVES: 150 XAH
- NGO RECEIVES BACK: 850 XAH
- CHANNEL STATUS: CLOSED
```

## TIMEOUT MECHANISM

### AUTOMATIC TIMEOUT FLOW
- **INACTIVITY THRESHOLD**: 15 MINUTES (CONFIGURABLE)
- **WARNING**: USER RECEIVES NOTIFICATION AT 10 MINUTES OF INACTIVITY
- **TIMEOUT ACTION**: SESSION TERMINATED, FINAL PAYMENT CALCULATED AND RELEASED
- **ESCROW RETURN**: UNUSED ESCROW FUNDS RETURNED TO EMPLOYER

### MANUAL OVERRIDE
EMPLOYERS CAN MANUALLY END SESSIONS OR ADJUST TIMEOUT SETTINGS PER WORKER.

## API ENDPOINTS

### WORKER MANAGEMENT ENDPOINTS
- `POST /API/WORKERS/ADD` - ADD WORKER TO ORGANIZATION
- `GET /API/WORKERS/LIST/:NGOWALLET` - LIST ALL WORKERS FOR ORGANIZATION

### WORKER ENDPOINTS
- `POST /API/WORKERS/CLOCK-IN` - START LOGGING HOURS
- `POST /API/WORKERS/CLOCK-OUT` - STOP LOGGING HOURS
- `GET /API/WORKERS/EARNINGS/:WALLET` - GET WORKER EARNINGS
- `GET /API/WORKERS/SESSIONS/:WALLET` - GET WORK SESSIONS

### ORGANIZATION ENDPOINTS
- `GET /API/ORGANIZATIONS/STATS/:WALLET` - GET ORGANIZATION STATISTICS
- `GET /API/ORGANIZATIONS/WORKERS/:WALLET` - GET ORGANIZATION WORKERS
- `GET /API/ORGANIZATIONS/ACTIVITY/:WALLET` - GET RECENT ACTIVITY
- `GET /API/ORGANIZATIONS/PAYMENT-CHANNELS/:WALLET` - GET PAYMENT CHANNELS

### PAYMENT CHANNEL ENDPOINTS
- `POST /API/PAYMENT-CHANNELS/CREATE` - CREATE NEW PAYMENT CHANNEL
- `POST /API/PAYMENT-CHANNELS/:CHANNELID/CLOSE` - INITIATE PAYMENT CHANNEL CANCELLATION (RETURNS XRPL TX DETAILS)
- `POST /API/PAYMENT-CHANNELS/:CHANNELID/CLOSE/CONFIRM` - CONFIRM CANCELLATION AFTER XRPL TRANSACTION

### XAMAN INTEGRATION ENDPOINTS
- `POST /API/XAMAN/CREATE-SIGNIN` - CREATE XAMAN QR CODE FOR SIGN-IN
- `GET /API/XAMAN/PAYLOAD/:UUID` - GET XAMAN PAYLOAD STATUS
- `POST /API/XAMAN/CANCEL/:UUID` - CANCEL XAMAN PAYLOAD

### HOOK ENDPOINTS
- `POST /API/HOOKS/VERIFY-INPUT` - VERIFY NGO INPUT SIGNATURE
- `POST /API/HOOKS/VALIDATE-TIME` - VALIDATE WORK HOURS
- `POST /API/HOOKS/CHECK-TIMEOUT` - CHECK FOR SESSION TIMEOUT

### WORKER DELETION ENDPOINTS
- `GET /API/WORKERS/DELETION-ELIGIBILITY` - CHECK IF WORKER CAN DELETE PROFILE
- `POST /API/WORKERS/DELETE-PROFILE` - INITIATE PROFILE DELETION (SOFT DELETE)
- `POST /API/WORKERS/CANCEL-DELETION` - CANCEL DELETION WITHIN 48-HOUR GRACE PERIOD
- `GET /API/WORKERS/DELETION-STATUS` - CHECK DELETION STATUS AND TIME REMAINING
- `GET /API/WORKERS/EXPORT-DATA` - EXPORT ALL WORKER DATA AS PDF (GDPR COMPLIANCE)

### NGO NOTIFICATION ENDPOINTS
- `GET /API/NGO-NOTIFICATIONS` - FETCH NOTIFICATIONS FOR NGO (INCLUDES WORKER DELETIONS)
- `PUT /API/NGO-NOTIFICATIONS/:ID/READ` - MARK NOTIFICATION AS READ

## WORKER DELETION SYSTEM

### OVERVIEW

COMPREHENSIVE WORKER PROFILE DELETION SYSTEM WITH GDPR COMPLIANCE, DATA EXPORT, AND ORGANIZATION NOTIFICATIONS.

**KEY FEATURES:**
- ‚úÖ **SOFT DELETE WITH 48-HOUR GRACE PERIOD**: REVERSIBLE DELETION WITH ACCOUNT RECOVERY
- ‚úÖ **HARD DELETE AFTER GRACE PERIOD**: PERMANENT DATA REMOVAL VIA SCHEDULED JOBS
- ‚úÖ **AUTOMATIC INACTIVITY DELETION**: WORKERS INACTIVE FOR 14+ DAYS AUTO-DELETED
- ‚úÖ **PDF DATA EXPORT**: DOWNLOAD ALL PERSONAL DATA BEFORE DELETION (GDPR RIGHT TO PORTABILITY)
- ‚úÖ **ORGANIZATION NOTIFICATIONS**: NGOS NOTIFIED WHEN WORKERS DELETE PROFILES
- ‚úÖ **SAFETY CHECKS**: CANNOT DELETE WITH ACTIVE PAYMENT CHANNELS OR UNPAID BALANCES
- ‚úÖ **AUDIT TRAIL**: COMPLETE DELETION LOGS FOR COMPLIANCE AND DEBUGGING

### DELETION FLOW FOR WORKERS

**STEP 1: CHECK ELIGIBILITY**
1. NAVIGATE TO EMPLOYEE SETTINGS PAGE
2. FIND "DANGER ZONE" SECTION
3. SYSTEM AUTOMATICALLY CHECKS:
   - ‚ùå NO ACTIVE PAYMENT CHANNELS
   - ‚ùå NO UNPAID BALANCES
   - ‚ùå NO UNRESOLVED DISPUTES
4. IF INELIGIBLE: WARNING MESSAGE WITH BLOCKING REASONS
5. IF ELIGIBLE: "DELETE MY PROFILE" BUTTON ENABLED

**STEP 2: EXPORT DATA (OPTIONAL BUT RECOMMENDED)**
1. CLICK "EXPORT MY DATA (PDF)" BUTTON
2. PDF DOWNLOADS WITH ALL YOUR DATA:
   - PERSONAL INFORMATION
   - WORK HISTORY AND HOURS LOGGED
   - PAYMENT RECORDS AND TRANSACTIONS
   - ORGANIZATION AFFILIATIONS
3. REVIEW DATA BEFORE PROCEEDING WITH DELETION

**STEP 3: INITIATE DELETION**
1. CLICK "DELETE MY PROFILE" BUTTON
2. CONFIRMATION MODAL APPEARS
3. TYPE "DELETE MY ACCOUNT" IN CONFIRMATION FIELD (EXACT MATCH REQUIRED)
4. SELECT DELETION REASON (OPTIONAL):
   - NO LONGER NEED SERVICE
   - SWITCHING TO DIFFERENT PLATFORM
   - PRIVACY CONCERNS
   - OTHER
5. CLICK "CONFIRM DELETION"

**STEP 4: SOFT DELETE (48-HOUR GRACE PERIOD)**
- SUCCESS MESSAGE DISPLAYS: "PROFILE DELETION SCHEDULED"
- YOUR ACCOUNT IS SOFT-DELETED (HIDDEN FROM UI)
- YOU HAVE 48 HOURS TO CANCEL DELETION
- AUTO-LOGOUT AFTER 10 SECONDS
- ALL ORGANIZATIONS YOU WORK FOR RECEIVE NOTIFICATION

**STEP 5: CANCEL DELETION (OPTIONAL - WITHIN 48 HOURS)**
1. LOG IN WITH YOUR WALLET
2. BANNER DISPLAYS: "YOUR PROFILE IS SCHEDULED FOR DELETION"
3. COUNTDOWN TIMER SHOWS TIME REMAINING
4. CLICK "CANCEL DELETION" BUTTON
5. ACCOUNT FULLY RESTORED
6. ORGANIZATIONS NOTIFIED OF CANCELLATION

**STEP 6: PERMANENT DELETION (AFTER 48 HOURS)**
- SCHEDULED JOB RUNS HOURLY
- IF GRACE PERIOD EXPIRED: PERMANENT DELETION
- ALL DATA REMOVED FROM DATABASE:
  - USER PROFILE AND ACCOUNT DATA
  - WORK SESSIONS AND HISTORY
  - PAYMENT RECORDS (AFTER AUDIT RETENTION)
  - ORGANIZATION AFFILIATIONS
- DELETION LOGGED IN AUDIT TRAIL
- **CANNOT BE UNDONE**

### AUTOMATIC INACTIVITY DELETION

**TRIGGER:** WORKERS INACTIVE FOR 14+ DAYS (NO LOGIN)

**PROCESS:**
1. SCHEDULED JOB RUNS DAILY AT 2:00 AM
2. IDENTIFIES WORKERS WITH NO LOGIN FOR 14+ DAYS
3. SOFT-DELETES WORKER ACCOUNTS (48-HOUR GRACE PERIOD)
4. SENDS NOTIFICATIONS TO ALL ORGANIZATIONS
5. DELETION REASON: "AUTOMATIC INACTIVITY DELETION"
6. WORKERS CAN STILL LOG IN AND CANCEL DELETION WITHIN 48 HOURS

**PREVENTING AUTOMATIC DELETION:**
- LOG IN AT LEAST ONCE EVERY 14 DAYS
- SYSTEM UPDATES `LAST_LOGIN_AT` TIMESTAMP ON EACH LOGIN
- NO ACTION REQUIRED IF YOU USE THE PLATFORM REGULARLY

### NGO NOTIFICATIONS

**WHEN WORKER DELETES PROFILE:**
1. NGO DASHBOARD SHOWS NOTIFICATION BADGE (RED DOT)
2. NOTIFICATION MESSAGE:
   - "WORKER [NAME] HAS DELETED THEIR PROFILE"
   - TIMESTAMP OF DELETION
   - LIST OF AFFECTED PAYMENT CHANNELS (IF ANY)
3. NGO CAN MARK NOTIFICATION AS READ
4. NOTIFICATION PERSISTS IN HISTORY FOR AUDIT

**NOTIFICATION TYPES:**
- `WORKER_DELETED` - WORKER INITIATED DELETION
- `WORKER_AUTO_DELETED` - AUTOMATIC INACTIVITY DELETION
- `WORKER_DELETION_CANCELLED` - WORKER CANCELLED DELETION

### SAFETY & SECURITY

**DELETION BLOCKED IF:**
- ‚ùå ACTIVE PAYMENT CHANNELS EXIST
- ‚ùå UNPAID BALANCE > 0 XAH
- ‚ùå PENDING DISPUTES OR CLAIMS
- ‚ùå PENDING TRANSACTIONS

**AUTHORIZATION:**
- ONLY WORKER CAN DELETE THEIR OWN PROFILE
- WALLET ADDRESS VALIDATION REQUIRED
- CONFIRMATION TEXT MUST MATCH EXACTLY

**DATA INTEGRITY:**
- CASCADING RULES PRESERVE REFERENTIAL INTEGRITY
- AUDIT TRAIL MAINTAINED IN `DELETION_LOGS` TABLE
- DELETION TIMESTAMP AND REASON RECORDED

**GDPR COMPLIANCE:**
- ‚úÖ RIGHT TO ERASURE (DELETION)
- ‚úÖ RIGHT TO DATA PORTABILITY (PDF EXPORT)
- ‚úÖ AUDIT TRAIL FOR COMPLIANCE VERIFICATION
- ‚úÖ 48-HOUR BUFFER PREVENTS ACCIDENTAL DELETION

### SCHEDULED JOBS

**HARD DELETE JOB:**
- **SCHEDULE:** RUNS HOURLY (`:00` MINUTES)
- **LOCATION:** `BACKEND/JOBS/HARDDELETE.JS`
- **CRON:** `0 * * * *`
- **PROCESS:**
  1. QUERY SOFT-DELETED USERS PAST 48-HOUR GRACE PERIOD
  2. PERMANENTLY DELETE USER DATA
  3. UPDATE DELETION LOGS WITH `HARD_DELETED_AT` TIMESTAMP
  4. LOG EXECUTION RESULTS

**INACTIVITY DELETION JOB:**
- **SCHEDULE:** RUNS DAILY AT 2:00 AM
- **LOCATION:** `BACKEND/JOBS/INACTIVITYDELETION.JS`
- **CRON:** `0 2 * * *`
- **PROCESS:**
  1. QUERY USERS WITH NO LOGIN FOR 14+ DAYS
  2. SOFT-DELETE INACTIVE USERS
  3. CREATE DELETION LOG ENTRIES
  4. NOTIFY ALL ORGANIZATIONS
  5. LOG EXECUTION RESULTS

**MONITORING:**
- JOB EXECUTION LOGS WRITTEN TO CONSOLE
- ERROR HANDLING WITH DETAILED ERROR MESSAGES
- METRICS: DELETION COUNT, SUCCESS RATE, EXECUTION TIME

### DATABASE SCHEMA

**NEW TABLES:**
- `DELETION_LOGS` - AUDIT TRAIL OF ALL DELETIONS
  - `WALLET_ADDRESS` - WORKER'S WALLET
  - `DELETED_BY` - WHO INITIATED (SELF, ADMIN, AUTOMATIC)
  - `DELETION_REASON` - REASON FOR DELETION
  - `SOFT_DELETED_AT` - SOFT DELETE TIMESTAMP
  - `HARD_DELETED_AT` - HARD DELETE TIMESTAMP (NULL IF PENDING)
  - `CANCELLED_AT` - CANCELLATION TIMESTAMP (IF CANCELLED)

- `NGO_NOTIFICATIONS` - ORGANIZATION NOTIFICATIONS
  - `ORGANIZATION_ID` - RECEIVING NGO
  - `WORKER_WALLET_ADDRESS` - AFFECTED WORKER
  - `NOTIFICATION_TYPE` - TYPE OF NOTIFICATION
  - `NOTIFICATION_MESSAGE` - MESSAGE TEXT
  - `IS_READ` - READ STATUS
  - `CREATED_AT` - TIMESTAMP

**UPDATED TABLES:**
- `USERS` TABLE:
  - `DELETED_AT TIMESTAMP` - SOFT DELETE TIMESTAMP (NULL = ACTIVE)
  - `DELETION_REASON TEXT` - REASON FOR DELETION
  - `LAST_LOGIN_AT TIMESTAMP` - TRACK INACTIVITY

**INDEXES:**
- `IDX_USERS_DELETED_AT` - FAST LOOKUP OF DELETED USERS
- `IDX_USERS_LAST_LOGIN` - INACTIVITY JOB OPTIMIZATION
- `IDX_DELETION_LOGS_WALLET` - AUDIT TRAIL QUERIES
- `IDX_NGO_NOTIFICATIONS_ORG_UNREAD` - NOTIFICATION COUNTS
- `IDX_NGO_NOTIFICATIONS_WORKER` - WORKER NOTIFICATIONS

### TESTING

**COMPREHENSIVE TEST SUITE:**
- **UNIT TESTS:** `BACKEND/TESTS/WORKERDELETION.TEST.JS` (870+ LINES)
  - 50+ TEST CASES COVERING ALL DELETION SCENARIOS
  - MOCKED DATABASE FOR FAST EXECUTION
  - TESTS FOR: ELIGIBILITY, DELETION, CANCELLATION, NOTIFICATIONS, JOBS

- **INTEGRATION TESTS:** `BACKEND/TESTS/WORKERDELETIONINTEGRATION.TEST.JS` (600+ LINES)
  - REAL POSTGRESQL DATABASE TESTING
  - END-TO-END DELETION WORKFLOWS
  - MULTI-ORGANIZATION SCENARIOS
  - ORPHANED RECORDS RE-ASSOCIATION
  - PDF EXPORT VALIDATION

- **MANUAL TESTING CHECKLIST:** `CLAUDEDOCS/WORKER_DELETION_TESTING_CHECKLIST.MD`
  - 20+ DETAILED TEST SCENARIOS
  - STEP-BY-STEP PROCEDURES
  - DATABASE VERIFICATION QUERIES
  - EDGE CASES AND PERFORMANCE TESTS

**RUN TESTS:**
```BASH
# RUN ALL TESTS
CD BACKEND && NPM TEST

# RUN SPECIFIC TEST SUITE
NPM TEST WORKERDELETION

# RUN WITH COVERAGE
NPM TEST -- --COVERAGE
```

### DEPLOYMENT

**PRE-DEPLOYMENT CHECKLIST:**
1. ‚úÖ BACKUP PRODUCTION DATABASE
2. ‚úÖ VALIDATE MIGRATION SCRIPT ON STAGING
3. ‚úÖ RUN ALL AUTOMATED TESTS
4. ‚úÖ COMPLETE MANUAL TESTING CHECKLIST
5. ‚úÖ CONFIGURE SCHEDULED JOBS (CRON)
6. ‚úÖ SET UP MONITORING AND ALERTS

**DATABASE MIGRATION:**
```BASH
# PRODUCTION MIGRATION (TRANSACTION-SAFE)
PSQL -U XAHPAYROLL_USER -H <PROD_DB_HOST> -D XAHPAYROLL

BEGIN;
\I BACKEND/DATABASE/MIGRATIONS/003_WORKER_DELETION.SQL
\D DELETION_LOGS
\D NGO_NOTIFICATIONS
COMMIT;  # OR ROLLBACK IF ISSUES
```

**SCHEDULED JOBS SETUP:**
```BASH
# ADD TO CRON (ON PRODUCTION SERVER)
CRONTAB -E

# HARD DELETE JOB (HOURLY)
0 * * * * NODE /PATH/TO/BACKEND/JOBS/HARDDELETE.JS

# INACTIVITY DELETION JOB (DAILY AT 2 AM)
0 2 * * * NODE /PATH/TO/BACKEND/JOBS/INACTIVITYDELETION.JS
```

**MONITORING:**
- LOG FILES: `BACKEND/LOGS/DELETION_JOBS.LOG`
- METRICS: DELETION SUCCESS RATE, JOB EXECUTION TIME
- ALERTS: JOB FAILURES, HIGH ERROR RATES

**FULL DEPLOYMENT GUIDE:** SEE `CLAUDEDOCS/WORKER_DELETION_DEPLOYMENT_GUIDE.MD` FOR DETAILED PROCEDURES

## ROADMAP

- [x] **WORKER DELETION SYSTEM** - COMPREHENSIVE PROFILE DELETION WITH GDPR COMPLIANCE ‚úÖ
- [ ] MULTI-CURRENCY SUPPORT (XRP, USD STABLECOINS)
- [ ] MOBILE APP (IOS/ANDROID)
- [ ] BIOMETRIC VERIFICATION FOR CLOCK IN/OUT
- [ ] INTEGRATION WITH TRADITIONAL PAYROLL SYSTEMS
- [ ] ADVANCED ANALYTICS AND REPORTING
- [ ] DAO GOVERNANCE FOR PLATFORM PARAMETERS
- [ ] MULTI-CHAIN SUPPORT (ETHEREUM, POLYGON)

## SECURITY

### ‚ö†Ô∏è IMPORTANT SECURITY NOTES

**NEVER COMMIT SENSITIVE DATA TO VERSION CONTROL:**
- Database passwords
- API keys
- Private keys or wallet secrets
- `.env` files with real credentials

**BEFORE DEPLOYING:**

1. **Change Default Passwords**
   - The `setup_database.sql` file contains a placeholder password `CHANGE_THIS_PASSWORD`
   - Generate a strong password: `openssl rand -base64 32`
   - Update the password in the SQL script before running
   - Store the password securely (password manager, environment variables)

2. **Environment Variables**
   - Copy `backend/.env.example` to `backend/.env`
   - Fill in all required values with your actual credentials
   - Never commit the `.env` file to git (already in `.gitignore`)

3. **Database Security**
   - Use different passwords for development, staging, and production
   - Enable SSL connections for production databases
   - Restrict database access by IP address
   - Regularly update and rotate credentials

4. **Wallet Security**
   - Never store private keys in code or environment variables
   - Use hardware wallets or secure key management services
   - Test with testnet wallets before using real funds

**REPORTING SECURITY ISSUES:**
- Email: security@xahpayroll.io
- Do NOT open public issues for security vulnerabilities

## CONTRIBUTING

WE WELCOME CONTRIBUTIONS! PLEASE SEE [CONTRIBUTING.MD](CONTRIBUTING.MD) FOR GUIDELINES.

## LICENSE

MIT LICENSE - SEE [LICENSE](LICENSE) FILE FOR DETAILS

## SUPPORT

- **DOCUMENTATION**: [DOCS.XAHPAYROLL.IO](HTTPS://DOCS.XAHPAYROLL.IO)
- **DISCORD**: [DISCORD.GG/XAHPAYROLL](HTTPS://DISCORD.GG/XAHPAYROLL)
- **EMAIL**: SUPPORT@XAHPAYROLL.IO
- **ISSUES**: [GITHUB ISSUES](HTTPS://GITHUB.COM/YOUR-ORG/XAH-PAYROLL/ISSUES)

## ACKNOWLEDGMENTS

BUILT ON THE XRP LEDGER (XRPL) WITH SUPPORT FROM THE XRPL DEVELOPER COMMUNITY.

---

**DISCLAIMER**: THIS IS EXPERIMENTAL SOFTWARE. ALWAYS TEST THOROUGHLY ON TESTNET BEFORE DEPLOYING TO MAINNET. NOT FINANCIAL ADVICE.
